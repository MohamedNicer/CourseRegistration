//@ui5-bundle instructor/Component-preload.js
sap.ui.predefine("instructor/Component", ["sap/ui/core/UIComponent","shared/auth/auth-service"],function(t,i){"use strict";return t.extend("instructor.Component",{metadata:{manifest:"json"},init:function(){t.prototype.init.apply(this,arguments);console.log("Instructor Component initialized - Using JSON models with fetch");this._initializeAuth()},_initializeAuth:async function(){try{if(typeof window.AuthService==="undefined"){console.warn("AuthService not available");return}await window.AuthService.init();const t=await window.AuthService.isAuthenticated();if(!t){console.log("User not authenticated, redirecting to login...");await window.AuthService.login();return}const i=await window.AuthService.getUser();console.log("User authenticated:",i.email);const e=await window.AuthService.getToken();console.log("Got Auth0 token for API requests")}catch(t){console.error("Auth initialization failed:",t)}}})});
sap.ui.predefine("instructor/controller/Main.controller", ["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox"],function(t,e,s,o){"use strict";return t.extend("instructor.controller.Main",{onInit:function(){console.log("Instructor Main Controller initialized");const t=new e({firstName:"",lastName:"",email:"",departmentName:""});this.getView().setModel(t,"profile");const s=new e({courses:[]});this.getView().setModel(s,"courses");const o=new e({enrollments:[]});this.getView().setModel(o,"enrollments");this._tabsLoaded={courses:false,enrollments:false,statistics:false};this._charts={};setTimeout(()=>{this._loadInstructorProfile()},500)},onAfterRendering:function(){if(!this._tabsLoaded.courses){setTimeout(()=>{this._loadInstructorCourses();this._tabsLoaded.courses=true},500)}},onTabSelect:function(t){const e=t.getParameter("key");if(e==="courses"&&!this._tabsLoaded.courses){this._loadInstructorCourses();this._tabsLoaded.courses=true}else if(e==="enrollments"&&!this._tabsLoaded.enrollments){this._loadEnrollments();this._tabsLoaded.enrollments=true}else if(e==="statistics"&&!this._tabsLoaded.statistics){this._loadStatistics();this._tabsLoaded.statistics=true}},onNavBack:function(){window.location.href="/launchpad.html"},onLogout:async function(){if(typeof window.AuthService!=="undefined"){await window.AuthService.logout()}else{window.location.href="../../launchpad.html"}},_loadInstructorProfile:async function(){try{if(typeof window.AuthService==="undefined"){console.error("AuthService not available");s.show("Authentication service not available");return}const t=await window.AuthService.getUser();console.log("Instructor user:",t);const e=this.getView().getModel("profile");e.setProperty("/email",t.email||"");const o=await window.AuthService.getToken();const r="/instructor/Instructors";console.log("Fetching from URL:",r);const n=await fetch(r,{headers:{Authorization:"Bearer "+o}});if(!n.ok){if(n.status===401){this._handleAuthError();return}else if(n.status===403){this._handleAuthorizationError();return}throw new Error(`HTTP ${n.status}: ${n.statusText}`)}const a=await n.json();console.log("Instructor profile response:",a);const i=a.value&&a.value[0]?a.value[0]:a;console.log("Setting profile data:",i);e.setProperty("/firstName",i.firstName||"");e.setProperty("/lastName",i.lastName||"");e.setProperty("/departmentName",i.department?.departmentName||i.departmentName||"");console.log("Profile model after update:",e.getData())}catch(t){console.error("Failed to load instructor profile:",t);this._handleError(t,"load instructor profile")}},_loadInstructorCourses:async function(){const t=this.byId("courseTable");try{console.log("Loading instructor courses...");if(t){t.setBusy(true)}const e=await window.AuthService.getToken();const s="/instructor/Courses";console.log("Fetching from URL:",s);const o=await fetch(s,{headers:{Authorization:"Bearer "+e}});if(!o.ok){if(o.status===401){this._handleAuthError();return}else if(o.status===403){this._handleAuthorizationError();return}throw new Error(`HTTP ${o.status}: ${o.statusText}`)}const r=await o.json();console.log("Instructor courses loaded:",r);console.log("Number of courses:",r.value?r.value.length:0);const n=this.getView().getModel("courses");if(!n){console.error("Courses model not found!");return}n.setProperty("/courses",r.value||[]);console.log("Courses model updated. Current data:",n.getData())}catch(t){console.error("Failed to load instructor courses:",t);this._handleError(t,"load instructor courses")}finally{if(t){t.setBusy(false)}}},_loadEnrollments:async function(){const t=this.byId("enrollmentTable");try{console.log("Loading enrollments...");if(t){t.setBusy(true)}const e=await window.AuthService.getToken();const s="/instructor/Enrollments?$expand=student,course";console.log("Fetching from URL:",s);const o=await fetch(s,{headers:{Authorization:"Bearer "+e}});if(!o.ok){if(o.status===401){this._handleAuthError();return}else if(o.status===403){this._handleAuthorizationError();return}throw new Error(`HTTP ${o.status}: ${o.statusText}`)}const r=await o.json();console.log("Enrollments loaded:",r);console.log("Number of enrollments:",r.value?r.value.length:0);if(r.value&&r.value.length>0){console.log("First enrollment sample:",JSON.stringify(r.value[0],null,2))}const n=this.getView().getModel("enrollments");if(!n){console.error("Enrollments model not found!");return}n.setProperty("/enrollments",r.value||[]);console.log("Enrollments model updated. Current data:",n.getData())}catch(t){console.error("Failed to load enrollments:",t);this._handleError(t,"load enrollments")}finally{if(t){t.setBusy(false)}}},onUpdateGrade:async function(t){const e=t.getSource();let r=null;try{const t=e.getBindingContext("enrollments");const n=t.getObject();console.log("Updating grade for enrollment:",n);const a=e.getParent();const i=a.getCells();r=i[6];const l=r.getValue().trim();if(!l){o.warning("Please enter a grade.");return}const c=parseFloat(l);if(isNaN(c)){o.warning("Grade must be a valid number.");r.setValueState("Error");r.setValueStateText("Grade must be a number");return}if(c<0||c>20){o.warning("Grade must be between 0 and 20.");r.setValueState("Error");r.setValueStateText("Grade must be between 0 and 20");return}r.setValueState("None");let u;if(c>=18){u="EXCELLENT"}else if(c>=16){u="VERY_GOOD"}else if(c>=14){u="GOOD"}else if(c>=12){u="SATISFACTORY"}else if(c>=10){u="PASSED"}else{u="FAILED"}e.setEnabled(false);e.setBusy(true);r.setEnabled(false);const d=await window.AuthService.getToken();const h={grade:c,status:u};const f=await fetch(`/instructor/Enrollments(${n.ID})`,{method:"PATCH",headers:{Authorization:"Bearer "+d,"Content-Type":"application/json"},body:JSON.stringify(h)});if(!f.ok){if(f.status===401){this._handleAuthError();return}else if(f.status===403){this._handleAuthorizationError();return}const t=await f.json().catch(()=>({}));throw new Error(t.error?.message||`HTTP ${f.status}: ${f.statusText}`)}const g=await f.json();console.log("Grade updated:",g);s.show(`Grade ${c} saved. Status updated to ${u} for ${n.student?.firstName} ${n.student?.lastName}`);this._refreshEnrollments()}catch(t){console.error("Failed to update grade:",t);o.error(`Failed to update grade: ${t.message}`)}finally{e.setEnabled(true);e.setBusy(false);if(r){r.setEnabled(true)}}},_refreshEnrollments:function(){const t=this.getView().getModel();if(t){t.refresh()}this._tabsLoaded.enrollments=false;this._loadEnrollments();this._tabsLoaded.enrollments=true},formatStatusState:function(t){switch(t){case"ENROLLED":return"Information";case"EXCELLENT":return"Success";case"VERY_GOOD":return"Success";case"GOOD":return"Success";case"SATISFACTORY":return"Warning";case"PASSED":return"Warning";case"FAILED":return"Error";case"COMPLETED":return"Success";case"DROPPED":return"None";default:return"None"}},_handleError:function(t,e){console.error(`[${e}] Error:`,t);s.show(`Failed to ${e}. Please try again.`)},_handleAuthError:function(){o.error("Your session has expired. Please log in again.",{onClose:async function(){await window.AuthService.login()}})},_handleAuthorizationError:function(){o.error("You don't have permission to access this resource.",{onClose:function(){window.location.href="../../launchpad.html"}})},_loadStatistics:async function(){try{console.log("Loading instructor statistics...");const t=await window.AuthService.getToken();const[e,s]=await Promise.all([fetch("/instructor/Courses",{headers:{Authorization:"Bearer "+t}}),fetch("/instructor/Enrollments",{headers:{Authorization:"Bearer "+t}})]);if(!e.ok||!s.ok){throw new Error("Failed to load statistics data")}const o=await e.json();const r=await s.json();console.log("Statistics data loaded");setTimeout(()=>{this._renderCourseCapacityChart(o.value||[]);this._renderGradeDistributionChart(r.value||[]);this._renderEnrollmentStatusChart(r.value||[])},500)}catch(t){console.error("Failed to load statistics:",t);s.show("Failed to load statistics")}},_renderCourseCapacityChart:function(t){const e=document.getElementById("instructorCourseCapacityChart");if(!e){console.warn("Course capacity chart canvas not found");return}if(this._charts.courseCapacity){this._charts.courseCapacity.destroy()}const s=t.map(t=>t.courseCode);const o=t.map(t=>t.enrolled||0);const r=t.map(t=>(t.quota||0)-(t.enrolled||0));const n=e.getContext("2d");this._charts.courseCapacity=new Chart(n,{type:"bar",data:{labels:s,datasets:[{label:"Enrolled",data:o,backgroundColor:"#0070F2"},{label:"Available",data:r,backgroundColor:"#E0E0E0"}]},options:{responsive:true,maintainAspectRatio:false,plugins:{title:{display:true,text:"Course Enrollment Capacity",font:{size:14}}},scales:{x:{stacked:true},y:{stacked:true,beginAtZero:true}}}})},_renderGradeDistributionChart:function(t){const e=document.getElementById("instructorGradeChart");if(!e){console.warn("Grade chart canvas not found");return}if(this._charts.grades){this._charts.grades.destroy()}const s={"A (18-20)":0,"B (15-17.9)":0,"C (12-14.9)":0,"D (10-11.9)":0,"F (<10)":0,"No Grade":0};t.forEach(t=>{const e=t.grade;if(e===null||e===undefined){s["No Grade"]++}else if(e>=18)s["A (18-20)"]++;else if(e>=15)s["B (15-17.9)"]++;else if(e>=12)s["C (12-14.9)"]++;else if(e>=10)s["D (10-11.9)"]++;else s["F (<10)"]++});const o=e.getContext("2d");this._charts.grades=new Chart(o,{type:"pie",data:{labels:Object.keys(s),datasets:[{data:Object.values(s),backgroundColor:["#107E3E","#0070F2","#E9730C","#C0399F","#D04343","#E0E0E0"]}]},options:{responsive:true,maintainAspectRatio:false,plugins:{title:{display:true,text:"Grade Distribution Across All Courses",font:{size:14}},legend:{position:"bottom"}}}})},_renderEnrollmentStatusChart:function(t){const e=document.getElementById("instructorStatusChart");if(!e){console.warn("Status chart canvas not found");return}if(this._charts.status){this._charts.status.destroy()}const s={};t.forEach(t=>{const e=t.status||"Unknown";s[e]=(s[e]||0)+1});const o=e.getContext("2d");this._charts.status=new Chart(o,{type:"doughnut",data:{labels:Object.keys(s),datasets:[{data:Object.values(s),backgroundColor:["#0070F2","#107E3E","#E9730C"]}]},options:{responsive:true,maintainAspectRatio:false,plugins:{title:{display:true,text:"Enrollment Status Overview",font:{size:14}},legend:{position:"bottom"}}}})}})});
sap.ui.require.preload({
	"instructor/manifest.json":'{"_version":"1.59.0","sap.app":{"id":"instructor","type":"application","title":"Course Registration - Instructor","description":"Manage courses and enrollments","applicationVersion":{"version":"1.0.0"}},"sap.ui":{"technology":"UI5","deviceTypes":{"desktop":true,"tablet":true,"phone":true}},"sap.ui5":{"rootView":{"viewName":"instructor.view.Main","type":"XML","id":"main"},"dependencies":{"minUI5Version":"1.120.0","libs":{"sap.m":{},"sap.ui.core":{},"sap.ui.table":{}}},"flexBundle":false}}',
	"instructor/view/Main.view.xml":'<mvc:View\r\n    controllerName="instructor.controller.Main"\r\n    xmlns:mvc="sap.ui.core.mvc"\r\n    xmlns="sap.m"\r\n    xmlns:core="sap.ui.core"\r\n    height="100%"><Page title="Instructor Portal" showNavButton="true" navButtonPress=".onNavBack"><headerContent><Button icon="sap-icon://log" text="Logout" press=".onLogout" type="Transparent"/></headerContent><content><VBox><Panel class="instructorHeader sapUiResponsiveMargin"><VBox><Title text="Welcome, {profile>/firstName} {profile>/lastName}" level="H2" class="instructorTitle"/><Text text="{profile>/email}"/><Text text="{profile>/departmentName}"/></VBox></Panel><IconTabBar id="iconTabBar" select=".onTabSelect" class="sapUiResponsiveMargin"><items><IconTabFilter text="My Courses" key="courses" icon="sap-icon://course-book"><VBox class="sapUiSmallMargin"><Title text="Courses I Teach" level="H2" class="sapUiSmallMarginBottom"/><Table\r\n                                    id="courseTable"\r\n                                    items="{courses>/courses}"><columns><Column width="12%"><Text text="Code"/></Column><Column width="30%"><Text text="Course Name"/></Column><Column width="8%"><Text text="ECTS"/></Column><Column width="15%"><Text text="Semester"/></Column><Column width="20%"><Text text="Department"/></Column><Column width="15%"><Text text="Enrollments"/></Column></columns><items><ColumnListItem><cells><Text text="{courses>courseCode}"/><Text text="{courses>courseName}"/><Text text="{courses>ects}"/><Text text="{courses>semester}"/><Text text="{courses>departmentName}"/><Text text="{courses>enrolled} / {courses>quota}"/></cells></ColumnListItem></items></Table></VBox></IconTabFilter><IconTabFilter text="Enrollments" key="enrollments" icon="sap-icon://education"><VBox class="sapUiSmallMargin"><Title text="Student Enrollments" level="H2" class="sapUiSmallMarginBottom"/><Table\r\n                                    id="enrollmentTable"\r\n                                    items="{enrollments>/enrollments}"><columns><Column width="15%"><Text text="Student Name"/></Column><Column width="12%"><Text text="Student Number"/></Column><Column width="18%"><Text text="Email"/></Column><Column width="12%"><Text text="Course Code"/></Column><Column width="18%"><Text text="Course Name"/></Column><Column width="10%"><Text text="Status"/></Column><Column width="10%"><Text text="Grade"/></Column><Column width="5%"><Text text=""/></Column></columns><items><ColumnListItem><cells><Text text="{enrollments>student/firstName} {enrollments>student/lastName}"/><Text text="{enrollments>student/studentNumber}"/><Text text="{enrollments>student/email}"/><Text text="{enrollments>course/courseCode}"/><Text text="{enrollments>course/courseName}"/><ObjectStatus \r\n                                                    text="{enrollments>status}"\r\n                                                    state="{parts: [{path: \'enrollments>status\', targetType: \'any\'}], formatter: \'.formatStatusState\'}"/><Input \r\n                                                    value="{enrollments>grade}"\r\n                                                    class="gradeInput"\r\n                                                    placeholder="Enter grade"/><Button \r\n                                                    icon="sap-icon://save"\r\n                                                    type="Emphasized"\r\n                                                    press=".onUpdateGrade"\r\n                                                    tooltip="Save Grade"/></cells></ColumnListItem></items></Table></VBox></IconTabFilter><IconTabFilter text="Statistics" key="statistics" icon="sap-icon://bar-chart"><VBox class="sapUiSmallMargin"><Title text="Teaching Analytics" level="H2" class="sapUiSmallMarginBottom"/><Panel headerText="Course Enrollment Overview" class="sapUiResponsiveMargin"><core:HTML content="&lt;canvas id=\'instructorCourseCapacityChart\' style=\'width: 100%; height: 300px;\'&gt;&lt;/canvas&gt;"/></Panel><Panel headerText="Grade Distribution" class="sapUiResponsiveMargin"><core:HTML content="&lt;canvas id=\'instructorGradeChart\' style=\'width: 100%; height: 300px;\'&gt;&lt;/canvas&gt;"/></Panel><Panel headerText="Enrollment Status" class="sapUiResponsiveMargin"><core:HTML content="&lt;canvas id=\'instructorStatusChart\' style=\'width: 100%; height: 250px;\'&gt;&lt;/canvas&gt;"/></Panel></VBox></IconTabFilter></items></IconTabBar></VBox></content></Page></mvc:View>\r\n'
});
//# sourceMappingURL=Component-preload.js.map
